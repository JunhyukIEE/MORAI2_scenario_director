local_path_planner:
  ros__parameters:
    # Map settings
    map.map_dir: "map"
    map.map_yaml: "Sangam_map.yaml"
    map.waypoints: "waypoints.csv"

    # Vehicle parameters
    vehicle.wheelbase: 2.35
    vehicle.max_steer: 0.436
    vehicle.max_steer_rate: 2.0     # rad/s — 조향 변화율 제한 (급조향 방지)
    vehicle.max_accel: 5.0          # m/s^2
    vehicle.max_decel: 7.0          # m/s^2
    vehicle.max_lat_accel: 8.5      # m/s^2 (professional driver level)

    # Reward weights
    weights.w_progress: 500.0       # Track progress reward
    weights.w_speed: 10.0           # Speed reward
    weights.w_overtake: 500.0       # Overtake reward
    weights.w_collision: 90000.0    # Collision penalty
    weights.w_offroad: 30000.0      # Offroad penalty (per point)
    weights.w_smooth: 10.0          # Smoothness penalty
    weights.w_curv: 20.0            # Curvature penalty
    weights.w_far_from_ref: 0.0     # Distance from reference line penalty

    # Vehicle dimensions (안전 마진 추가)
    ego_length: 4.0
    ego_width: 2.0
    opp_length: 4.0
    opp_width: 2.0

    # 갭 통과 안전 설정 (벽과 상대차량 사이 공간 체크)
    pass_gap_margin: 0.5            # 통과 시 필요한 추가 마진 (m)
    gap_check_distance: 300.0       # 갭 체크할 전방 거리 (m)
    impassable_penalty: 9000.0      # 통과 불가능 방향 페널티

    # Candidate generation
    speed_scales: [0.80, 0.90, 1.0, 1.10]

    # Safety settings
    offroad_check_stride: 2         # Check every N-th point for offroad
    overtake_margin_s: 15.0         # Distance ahead to consider overtake complete
    near_pass_bonus_dist: 0.0       # 근접 보너스

    # Hysteresis (방향 변경 페널티 - 갈팡질팡 방지)
    lat_change_penalty: 80.0        # 1m offset 변경 시 페널티 (높을수록 방향 유지)
    overtake_side_commit_penalty: 100.0  # 추월 중 사이드 변경 페널티 (한쪽 선택 후 고수)

    # 추월 전략 설정
    # Late Braking (브레이킹 포인트 기반)
    strategy.overtake.late_braking.enabled: true
    strategy.overtake.late_braking.delay_factor: 1.0           # 브레이킹 지연 비율 (0.0~1.0, 높을수록 늦게)
    strategy.overtake.late_braking.outside_offset: 2.0         # 브레이킹 전 바깥쪽 오프셋 (m)
    strategy.overtake.late_braking.inside_offset: 1.0          # apex에서 안쪽 오프셋 (m)
    strategy.overtake.late_braking.transition_sharpness: 0.9   # 전환 날카로움 (높을수록 급격히 꺾음)
    strategy.overtake.late_braking.min_corner_curvature: 0.05  # late braking 적용 최소 곡률
    strategy.overtake.late_braking.safety_margin: 1.15         # 브레이킹 거리 안전 마진
    strategy.overtake.late_braking.max_decel_override: 0.0     # 0이면 vehicle.max_decel 사용
    strategy.overtake.late_braking.exit_recovery_distance: 500.0 # apex 후 레이싱라인 복귀 거리 (m)

    # 공통 설정
    strategy.overtake.min_corner_curvature: 0.025
    strategy.overtake.apex_search_distance: 200.0

    # Phase 기반 추월 전략
    strategy.overtake.approach_speed_boost: 1.05      # 접근 단계 속도 부스트
    strategy.overtake.position_lateral_offset: 1.7    # 위치 선점 시 목표 lateral offset (m)
    strategy.overtake.execute_speed_boost: 1.12       # 실행 단계 속도 부스트
    strategy.overtake.slipstream_distance: 0.0       # 슬립스트림 효과 거리 (m)
    strategy.overtake.slipstream_speed_boost: 1.06    # 슬립스트림 속도 부스트
    strategy.overtake.gap_reward_scale: 300.0         # 갭 찾기 보상 스케일 (높을수록 적극적)

    # 동적 회피 경로 설정 (상대 차량 기반)
    # entry/exit 거리는 scenario_director.yaml의 overtake 파라미터 사용
    strategy.overtake.avoidance_path_smoothness: 2.0  # 경로 부드러움 (1.0~3.0)
    strategy.overtake.avoidance_offsets: [2.0, 2.5, 3.0, 3.5, 4.0, 5.0, 7.0, 8.0]  # 회피 offset 후보 (m)
